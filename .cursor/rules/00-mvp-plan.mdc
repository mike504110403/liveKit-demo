# MVP é–‹ç™¼è¨ˆåŠƒ - æœ€å°å¯è¡Œæ–¹æ¡ˆ

> **ç›®æ¨™**: å¯¦ç¾åŸºæœ¬çš„ç›´æ’­æ¨æµã€è§€çœ‹å’ŒèŠå¤©åŠŸèƒ½

## MVP æ ¸å¿ƒåŠŸèƒ½

### å¿…é ˆå¯¦ç¾ âœ…
1. âœ… ä¸»æ’­ç™»å…¥ï¼ˆç°¡åŒ–ç‰ˆï¼Œå…§å­˜å­˜å„²ï¼‰
2. âœ… ä¸»æ’­é–‹å•Ÿç›´æ’­ï¼ˆæ¨æµï¼‰
3. âœ… è§€çœ¾ç™»å…¥
4. âœ… è§€çœ¾è§€çœ‹ç›´æ’­ï¼ˆæ‹‰æµï¼‰
5. âœ… èŠå¤©å®¤äº’é€šï¼ˆWebSocketï¼‰

### ä¸éœ€è¦å¯¦ç¾ âŒ
- âŒ æ•¸æ“šåº«æŒä¹…åŒ–
- âŒ S3 å­˜å„²
- âŒ éŒ„è£½åŠŸèƒ½
- âŒ è¤‡é›œçš„ç”¨æˆ¶ç³»çµ±
- âŒ æ‰“è³åŠŸèƒ½
- âŒ æ•¸æ“šçµ±è¨ˆ

## é–‹ç™¼é †åº

### Phase 1: SRS ç›´æ’­æœå‹™ ğŸ¯
**æ™‚é–“**: 30åˆ†é˜
```bash
1. é…ç½® SRSï¼ˆsrs/conf/srs.confï¼‰
2. Docker å•Ÿå‹• SRS
3. æ¸¬è©¦æ¨æµï¼ˆç”¨ OBSï¼‰
4. æ¸¬è©¦æ‹‰æµï¼ˆç”¨ç€è¦½å™¨ï¼‰
```

### Phase 2: å¾Œç«¯æœå‹™ï¼ˆç°¡åŒ–ç‰ˆï¼‰ğŸ¯
**æ™‚é–“**: 1-2å°æ™‚
```bash
1. å»ºç«‹ Go å°ˆæ¡ˆçµæ§‹
2. å…§å­˜å­˜å„²ï¼ˆä¸ç”¨ DBï¼‰
   - ç”¨æˆ¶åˆ—è¡¨ï¼ˆMapï¼‰
   - ç›´æ’­é–“åˆ—è¡¨ï¼ˆMapï¼‰
   - åœ¨ç·šç”¨æˆ¶ï¼ˆMapï¼‰
3. WebSocket èŠå¤©å®¤
4. åŸºæœ¬ API
   - POST /loginï¼ˆè¿”å› tokenï¼‰
   - POST /roomsï¼ˆå‰µå»ºç›´æ’­é–“ï¼‰
   - GET /roomsï¼ˆç²å–åˆ—è¡¨ï¼‰
   - GET /rooms/:id/play_url
   - WS /chat/:room_id
```

### Phase 3: Flutter App ğŸ¯
**æ™‚é–“**: 2-3å°æ™‚
```bash
1. ç™»å…¥é é¢ï¼ˆè¼¸å…¥æš±ç¨±å³å¯ï¼‰
2. ç›´æ’­é–“åˆ—è¡¨
3. æ¨æµé é¢ï¼ˆä¸»æ’­ï¼‰
4. è§€çœ‹é é¢ï¼ˆè§€çœ¾ï¼‰
5. èŠå¤©å®¤ï¼ˆWebSocketï¼‰
```

## æŠ€è¡“æ¶æ§‹ï¼ˆç°¡åŒ–ç‰ˆï¼‰

```
Flutter App (ä¸»æ’­)
    â†“ æ¨æµ RTMP
  SRS æœå‹™å™¨
    â†“ æ‹‰æµ HLS/FLV
Flutter App (è§€çœ¾)

å…©å€‹ App éƒ½é€£æ¥ â†â†’ å¾Œç«¯ WebSocket (èŠå¤©)
```

## æ•¸æ“šçµæ§‹ï¼ˆå…§å­˜å­˜å„²ï¼‰

### ç”¨æˆ¶
```go
type User struct {
    ID       string
    Nickname string
    Token    string
}

var users = make(map[string]*User)  // token -> User
```

### ç›´æ’­é–“
```go
type Room struct {
    ID          string
    Title       string
    StreamKey   string
    Status      string    // idle, live
    HostID      string
    ViewerCount int
}

var rooms = make(map[string]*Room)  // roomID -> Room
```

### èŠå¤©è¨Šæ¯
```go
type ChatMessage struct {
    RoomID   string
    UserID   string
    Nickname string
    Message  string
    Time     time.Time
}

// WebSocket é€£æ¥æ± 
var chatConnections = make(map[string][]*websocket.Conn)
```

## API è¨­è¨ˆï¼ˆæ¥µç°¡ç‰ˆï¼‰

### 1. ç™»å…¥
```
POST /api/login
Body: { "nickname": "å°æ˜" }
Response: { "token": "abc123", "user_id": "1" }
```

### 2. å‰µå»ºç›´æ’­é–“
```
POST /api/rooms
Header: Authorization: Bearer {token}
Body: { "title": "æˆ‘çš„ç›´æ’­é–“" }
Response: {
  "room_id": "room1",
  "stream_key": "key123",
  "rtmp_url": "rtmp://localhost:1935/live/key123"
}
```

### 3. ç²å–ç›´æ’­é–“åˆ—è¡¨
```
GET /api/rooms
Response: [
  {
    "room_id": "room1",
    "title": "å°æ˜çš„ç›´æ’­é–“",
    "status": "live",
    "viewer_count": 5
  }
]
```

### 4. ç²å–æ’­æ”¾åœ°å€
```
GET /api/rooms/:id/play_url
Response: {
  "hls": "http://localhost:8080/live/key123.m3u8",
  "flv": "http://localhost:8080/live/key123.flv"
}
```

### 5. WebSocket èŠå¤©
```
WS /chat/:room_id?token={token}

ç™¼é€: { "message": "Hello" }
æ¥æ”¶: {
  "user_id": "1",
  "nickname": "å°æ˜",
  "message": "Hello",
  "time": "2024-01-01 12:00:00"
}
```

## Flutter é é¢æµç¨‹

```
1. ç™»å…¥é  (LoginScreen)
   â†“ è¼¸å…¥æš±ç¨±
   
2. é¦–é  (HomeScreen)
   â”œâ”€ é–‹å§‹ç›´æ’­æŒ‰éˆ• â†’ æ¨æµé  (StreamScreen)
   â””â”€ ç›´æ’­é–“åˆ—è¡¨ â†’ è§€çœ‹é  (PlayerScreen)
   
3. æ¨æµé  (StreamScreen)
   â”œâ”€ æœ¬åœ°é è¦½
   â”œâ”€ é–‹å§‹/åœæ­¢æ¨æµæŒ‰éˆ•
   â””â”€ èŠå¤©å®¤

4. è§€çœ‹é  (PlayerScreen)
   â”œâ”€ è¦–é »æ’­æ”¾å™¨
   â”œâ”€ è§€çœ‹äººæ•¸
   â””â”€ èŠå¤©å®¤
```

## æ¨æµæ–¹æ¡ˆï¼ˆDemo éšæ®µï¼‰

### æ–¹æ¡ˆ A: OBS æ¨æµï¼ˆæ¨è–¦ï¼‰âœ…
**å„ªé»**: ç„¡éœ€é–‹ç™¼ï¼Œç«‹å³å¯ç”¨
**æ­¥é©Ÿ**:
1. ä¸»æ’­é»æ“Š"é–‹å§‹ç›´æ’­"ç²å–æ¨æµåœ°å€
2. ä½¿ç”¨ OBS æ¨æµ
3. è§€çœ¾å¯ä»¥è§€çœ‹

### æ–¹æ¡ˆ B: Flutter æ¨æµï¼ˆé€²éšï¼‰
**éœ€è¦**: é›†æˆç¬¬ä¸‰æ–¹ SDK æˆ–ä½¿ç”¨ Platform Channel
**æ™‚é–“**: é¡å¤– 2-3 å¤©

**MVP å»ºè­°**: å…ˆç”¨æ–¹æ¡ˆ Aï¼ˆOBSï¼‰ï¼Œèƒ½è·‘é€šæµç¨‹å¾Œå†è€ƒæ…®æ–¹æ¡ˆ B

## å¿«é€Ÿå•Ÿå‹•è…³æœ¬

### 1. å•Ÿå‹• SRS
```bash
docker run -d --name srs \
  -p 1935:1935 \
  -p 8080:8080 \
  -p 1985:1985 \
  -v $(pwd)/srs/conf/srs.conf:/usr/local/srs/conf/srs.conf \
  ossrs/srs:5
```

### 2. å•Ÿå‹•å¾Œç«¯
```bash
cd backend
go run main.go
```

### 3. é‹è¡Œ Flutter
```bash
cd frontend
flutter run
```

## æ¸¬è©¦æµç¨‹

### å®Œæ•´æµç¨‹æ¸¬è©¦
```
1. ä¸»æ’­ App:
   - ç™»å…¥ï¼ˆæš±ç¨±: å°æ˜ï¼‰
   - é»æ“Š"é–‹å§‹ç›´æ’­"
   - ç²å–æ¨æµåœ°å€
   - ç”¨ OBS æ¨æµ

2. è§€çœ¾ App:
   - ç™»å…¥ï¼ˆæš±ç¨±: å°è¯ï¼‰
   - çœ‹åˆ°"å°æ˜çš„ç›´æ’­é–“"
   - é»æ“Šé€²å…¥
   - é–‹å§‹æ’­æ”¾è¦–é »

3. èŠå¤©æ¸¬è©¦:
   - ä¸»æ’­ç™¼é€: "å¤§å®¶å¥½"
   - è§€çœ¾çœ‹åˆ°è¨Šæ¯
   - è§€çœ¾å›è¦†: "Hi"
   - ä¸»æ’­çœ‹åˆ°è¨Šæ¯
```

## ç›®éŒ„çµæ§‹ï¼ˆMVP ç‰ˆï¼‰

```
liveKit-demo/
â”œâ”€â”€ srs/
â”‚   â””â”€â”€ conf/
â”‚       â””â”€â”€ srs.conf          # SRS é…ç½®ï¼ˆç°¡åŒ–ç‰ˆï¼‰
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ main.go               # å–®æ–‡ä»¶å³å¯
â”‚   â””â”€â”€ go.mod
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ lib/
â”‚       â”œâ”€â”€ main.dart
â”‚       â”œâ”€â”€ screens/
â”‚       â”‚   â”œâ”€â”€ login_screen.dart
â”‚       â”‚   â”œâ”€â”€ home_screen.dart
â”‚       â”‚   â”œâ”€â”€ stream_screen.dart
â”‚       â”‚   â””â”€â”€ player_screen.dart
â”‚       â”œâ”€â”€ services/
â”‚       â”‚   â”œâ”€â”€ api_service.dart
â”‚       â”‚   â””â”€â”€ websocket_service.dart
â”‚       â””â”€â”€ models/
â”‚           â”œâ”€â”€ user.dart
â”‚           â””â”€â”€ room.dart
â””â”€â”€ .cursor/rules/
    â”œâ”€â”€ 00-mvp-plan.mdc       # æœ¬æ–‡ä»¶
    â”œâ”€â”€ 01-srs-setup.mdc
    â”œâ”€â”€ 02-backend-simple.mdc
    â””â”€â”€ 03-flutter-app.mdc
```

## æ³¨æ„äº‹é …

1. **ç¶²çµ¡é…ç½®**: ç¢ºä¿ Flutter èƒ½è¨ªå•åˆ°æœ¬åœ°çš„ SRS å’Œå¾Œç«¯
   - Android: ä½¿ç”¨ `10.0.2.2` ä»£æ›¿ `localhost`
   - iOS: å…è¨±æœ¬åœ°ç¶²çµ¡è¨ªå•

2. **æ¨æµå»¶é²**: HLS å»¶é²ç´„ 10 ç§’ï¼ŒFLV ç´„ 3 ç§’

3. **èŠå¤©åŒæ­¥**: ä½¿ç”¨ WebSocket ä¿æŒé€£æ¥

4. **éŒ¯èª¤è™•ç†**: MVP éšæ®µç°¡å–®è™•ç†å³å¯

## æ™‚é–“ä¼°ç®—

| éšæ®µ | æ™‚é–“ | èªªæ˜ |
|------|------|------|
| SRS é…ç½® | 30åˆ†é˜ | é…ç½®æ–‡ä»¶ + Docker |
| å¾Œç«¯é–‹ç™¼ | 2å°æ™‚ | å…§å­˜å­˜å„² + WebSocket |
| Flutter UI | 3å°æ™‚ | 4å€‹é é¢ + åŸºæœ¬åŠŸèƒ½ |
| æ¸¬è©¦èª¿è©¦ | 1å°æ™‚ | è¯èª¿å’Œæ¸¬è©¦ |
| **ç¸½è¨ˆ** | **6-7å°æ™‚** | ä¸€å€‹å·¥ä½œæ—¥å®Œæˆ |

## æˆåŠŸæ¨™æº–

âœ… ä¸»æ’­å¯ä»¥é–‹å•Ÿç›´æ’­ï¼ˆç”¨ OBS æ¨æµï¼‰
âœ… è§€çœ¾å¯ä»¥çœ‹åˆ°ç›´æ’­é–“åˆ—è¡¨
âœ… è§€çœ¾å¯ä»¥æ’­æ”¾è¦–é »
âœ… èŠå¤©å®¤è¨Šæ¯èƒ½äº’é€š
âœ… æ•´å€‹æµç¨‹é †æš¢ç„¡å¡é “

---

**æº–å‚™å¥½äº†å—ï¼Ÿæˆ‘å€‘å¾ SRS é…ç½®é–‹å§‹ï¼**
