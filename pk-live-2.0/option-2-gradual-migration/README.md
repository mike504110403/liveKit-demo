# 選項 2: 外包接回來後逐步替換

> **版本**: v1.0  
> **制定日期**: 2026-01-13  
> **時程**: 6-7 個月（MVP），12-14 個月（完整版）

---

##  選項概述

### 前提條件
-  外包代碼能夠取得
-  舊系統可繼續運行

### 核心策略
逐步將模組替換為微服務，直至完全替換：

```
階段 1: 瓶頸分析（Week 1-2）
   ↓
階段 2: 優先級排序（Week 2-3）
   ↓
階段 3: 模組替換（Week 4-28）
   ├── 模組 1 替換
   ├── 模組 2 替換
   ├── 模組 3 替換
   └── ...
   ↓
階段 4: 完全遷移（Week 29-32）
```

### 優點
-  **風險最低**（技術風險低、業務風險低）
-  **業務不中斷**（新舊系統並行）
-  **可優先替換瓶頸模組**（資深 PHP 工程師分析）
-  **可逐步驗證**（每個模組獨立驗證）

### 缺點
-  需要維護兩套系統（過渡期）
-  過渡期較長（6-7 個月）
-  技術棧混雜（PHP + Go）

---

## 📁 文檔結構

```
option-2-gradual-migration/
├── README.md                    # 本文件
├── PROPOSAL.md                  # 企劃書（待完成）
├── PRESENTATION.md              # 簡報文檔（待完成）
└── docs/
    ├── cost/
    │   ├── 01-dual-system-cost.md      # 雙系統維護成本
    │   ├── 02-infrastructure-cost.md   # 基礎設施成本
    │   └── 03-total-cost.md            # 總成本分析
    ├── human-resources/
    │   ├── 01-php-team.md              # PHP 維護團隊
    │   ├── 02-go-team.md               # Go 開發團隊
    │   └── 03-client-team.md           # 客戶端團隊
    └── schedule/
        ├── 01-module-replacement.md    # 模組替換計劃
        ├── 02-traffic-switching.md     # 流量切換計劃
        └── 03-gantt-chart.md           # 甘特圖
```

---

##  關鍵工作項

### Week 1-2: 瓶頸分析階段 （最關鍵）
- [ ] 資深 PHP 工程師到位（1-2 人）
- [ ] 深度代碼審查
- [ ] **性能瓶頸識別**（慢查詢、高 CPU、高內存）
- [ ] **模組依賴關係分析**
- [ ] **優先替換模組清單**
- [ ] 產出瓶頸分析報告

**產出**: 瓶頸分析報告（決定後續替換順序和架構設計）

### Week 2-3: 優先級排序 
- [ ] **基於瓶頸分析**確定替換順序
- [ ] 設計新舊系統並行架構
- [ ] 設計流量切換方案
- [ ] 設計數據同步方案

**產出**: 模組替換優先級清單、並行架構文檔（此階段才能確定）

### Week 4-28: 模組替換（逐步進行）
- [ ] Batch 1: 優先模組替換（基於分析結果）
- [ ] Batch 2: 次優先模組替換
- [ ] Batch 3: 一般模組替換
- [ ] Batch 4: 剩餘模組替換
- [ ] 每個模組: 開發 → 測試 → 灰度 → 驗證

**說明**: 具體模組和順序取決於 Week 1-2 的瓶頸分析結果

### Week 29-32: 完全遷移 
- [ ] 關閉 PHP 系統（ 重要里程碑）
- [ ] 流量 100% 切換至 Go 系統
- [ ] 全量回歸測試
- [ ] 性能優化

---

##  預估時程

### MVP（不含招聘：7 個月 / 含招聘：8 個月）

**不含招聘**:
- Phase 1: 瓶頸分析（2 週）
- Phase 2: 優先級排序（1 週）
- Phase 3: 模組替換（22 週）
- Phase 4: 測試上線（3 週）
- **總計**: 28 週（**7 個月**）

**含招聘時間**:
- Phase 0: 招聘與準備（4 週）
  - PM 並行進行需求整理與外包代碼初步分析
  - 關鍵人員招聘（資深 PHP、Tech Lead）
- Phase 1-4: 同上（28 週）
- **總計**: 32 週（**8 個月 MVP**）

### 完整版（不含招聘：14 個月 / 含招聘：15 個月）
- 招聘與準備: 1 個月
- MVP: 7 個月
- 剩餘模組替換: 5 個月
- 優化上線: 2 個月
- **總計**: **15 個月** （過渡期最長）

---

##  預估成本

### 7 個月（MVP）
- 人力成本: $455K-980K（22-28 人 × 7 個月，含 PHP 維護團隊）
- 基礎設施: $15K-30K（雙系統維護）
- 第三方服務: $40K-80K
- **總計**: **$510K-1.09M**

### 14 個月（完整版）
- 人力成本: $910K-1.96M（22-28 人 × 14 個月）
- 基礎設施: $30K-60K
- 第三方服務: $80K-160K
- **總計**: **$1.02M-2.18M**

---

##  人力需求

### 總人數: 22-28 人

- **PHP 維護團隊**: 2-3 人（過渡期維護舊系統）
- **Go 後端團隊**: 7 人（6 個微服務 + 1 個遊戲中介層）
- **遊戲服務團隊**: 5-6 人
  - Tech Lead: 1 人
  - 後端工程師（Go/Java/C#）: 2-3 人
  - Unity 前端工程師: 2 人
- **原生客戶端團隊**: 3-4 人
  - iOS: 1 人（基礎）+ 0-1 人（保險）
  - Android: 1 人（基礎）+ 0-1 人（保險）
  - （逐步替換，基礎人力即可，為保險多配 1-2 人）
- **基礎設施團隊**: 4-6 人（DevOps + QA，雙系統維護）
- **設計團隊**: 1-2 人（UI/UX，可外包）

---

##  重要說明

**架構部分需等待 Week 1-2 瓶頸分析完成後才能確定**

在拿到外包代碼並完成瓶頸分析前：
-  無法確定哪些模組優先替換
-  無法確定新舊並行架構
-  無法確定流量切換方案
-  無法確定數據同步方案

**Week 1-3 的瓶頸分析與優先級排序是選項2的核心**，決定了後續所有技術決策。

##  下一步

1.  成本分析文檔（已完成）
2.  人力配置文檔（已完成）
3.  排程規劃文檔（已完成）
4. ⏳ 等待瓶頸分析完成後補充架構文檔
5. ⏳ 產出企劃書（PROPOSAL.md）
6. ⏳ 產出簡報文檔（PRESENTATION.md）

---

**版本**: v1.0  
**更新日期**: 2026-01-13
